---
description: 対話型または提供された原則入力からプロジェクト憲法を作成または更新し、すべての依存テンプレートが同期を維持するようにします。
---

ユーザー入力は、エージェントによって直接提供されるか、コマンド引数として提供される可能性があります。**必ず**それを考慮してプロンプトを進めてください（空でない場合）。

ユーザー入力:

$ARGUMENTS

`.specify/memory/constitution.md`でプロジェクト憲法を更新しています。このファイルは、角括弧内にプレースホルダー（例: `[PROJECT_NAME]`, `[PRINCIPLE_1_NAME]`）を含むテンプレートです。あなたの仕事は、(a)具体的な値を収集/導出し、(b)テンプレートを正確に埋め、(c)依存アーティファクト全体に修正を伝播することです。

以下の実行フローに従ってください:

1. `.specify/memory/constitution.md`にある既存の憲法テンプレートを読み込みます。
   - `[ALL_CAPS_IDENTIFIER]`形式のすべてのプレースホルダーを特定します。
   **重要**: ユーザーがテンプレートで使用されているものよりも少ないまたは多い原則を必要とする場合があります。数が指定されている場合、それに従ってください - 一般的なテンプレートに従います。ドキュメントを適宜更新します。

2. プレースホルダーの値を収集/導出:
   - ユーザー入力（会話）で値が提供されている場合、それを使用します。
   - それ以外の場合、既存のリポジトリコンテキスト（README、ドキュメント、以前の憲法バージョンが埋め込まれている場合）から推測します。
   - ガバナンスの日付について: `RATIFICATION_DATE`は元の採択日（不明な場合は尋ねるかTODOとしてマーク）、`LAST_AMENDED_DATE`は変更が加えられた場合は今日、それ以外の場合は以前の日付を保持します。
   - `CONSTITUTION_VERSION`はセマンティックバージョニングルールに従って増加する必要があります:
     * メジャー: 後方互換性のないガバナンス/原則の削除または再定義。
     * マイナー: 新しい原則/セクションの追加または実質的なガイダンスの拡張。
     * パッチ: 明確化、表現、タイプミスの修正、非意味的な改良。
   - バージョンの増加タイプが曖昧な場合、最終決定前に理由を提案します。

3. 更新された憲法コンテンツをドラフト:
   - すべてのプレースホルダーを具体的なテキストに置き換えます（プロジェクトがまだ定義しないことを選択したテンプレートスロットを意図的に保持する場合を除き、角括弧付きトークンは残さない）。
   - 見出しの階層を保持し、コメントは置き換えられた後に削除できますが、まだ明確なガイダンスを追加する場合は残します。
   - 各原則セクションを確保: 簡潔な名前行、非交渉可能なルールをキャプチャする段落（または箇条書きリスト）、明確でない場合は明示的な理由。
   - ガバナンスセクションには、修正手順、バージョン管理ポリシー、コンプライアンスレビューの期待事項をリストします。

4. 一貫性の伝播チェックリスト（以前のチェックリストをアクティブな検証に変換）:
   - `.specify/templates/plan-template.md`を読み取り、"憲法チェック"またはルールが更新された原則と一致していることを確認します。
   - `.specify/templates/spec-template.md`を読み取り、スコープ/要件の整合性を確認します—憲法が必須セクションまたは制約を追加/削除する場合は更新します。
   - `.specify/templates/tasks-template.md`を読み取り、タスクの分類が新しいまたは削除された原則駆動のタスクタイプ（例: 可観測性、バージョニング、テスト規律）を反映していることを確認します。
   - `.specify/templates/commands/*.md`内の各コマンドファイルを読み取り（これを含む）、古い参照（エージェント固有の名前、例: CLAUDE）が残っていないことを確認します。
   - 任意のランタイムガイダンスドキュメント（例: `README.md`、`docs/quickstart.md`、またはエージェント固有のガイダンスファイルが存在する場合）を読み取り、変更された原則への参照を更新します。

5. 同期影響レポートを生成（更新後、憲法ファイルの冒頭にHTMLコメントとして追加）:
   - バージョン変更: 古いバージョン → 新しいバージョン
   - 変更された原則のリスト（古いタイトル → 新しいタイトル、名前が変更された場合）
   - 追加されたセクション
   - 削除されたセクション
   - 更新が必要なテンプレート（✅ 更新済み / ⚠ 保留中）とファイルパス
   - 意図的に延期されたプレースホルダーがある場合のフォローアップTODO。

6. 最終出力前の検証:
   - 未説明の角括弧トークンが残っていない。
   - バージョン行がレポートと一致している。
   - 日付がISO形式YYYY-MM-DDである。
   - 原則が宣言的、テスト可能であり、曖昧な言語がない（"すべき" → 必要に応じてMUST/SHOULDの理由に置き換え）。

7. 完成した憲法を`.specify/memory/constitution.md`に書き戻します（上書き）。

8. ユーザーに最終要約を出力:
   - 新しいバージョンと増加理由。
   - 手動フォローアップが必要なファイル。
   - 推奨コミットメッセージ（例: `docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

フォーマットとスタイル要件:
- テンプレートとまったく同じMarkdown見出しを使用（レベルを降格/昇格しない）。
- 読みやすさを維持するために長い理由行を折り返す（理想的には<100文字）ただし、不自然な改行は避ける。
- セクション間に1行の空白を保持。
- 末尾の空白を避ける。

ユーザーが部分的な更新を提供した場合（例: 1つの原則の修正のみ）、検証とバージョン決定ステップを引き続き実行します。

重要な情報が欠落している場合（例: 批准日が本当に不明）、`TODO(<FIELD_NAME>): explanation`を挿入し、同期影響レポートの延期項目に含めます。

新しいテンプレートを作成しないでください; 常に既存の`.specify/memory/constitution.md`ファイルで操作します。
